<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>filter过滤器</title>
    <link rel="stylesheet" href="../../fonts/iconfont.css" />
    <style>
        #map {
            width: 600px;
            height: 600px;
            position: relative;
            box-sizing: border-box;
            background: #ddd;
            margin-top: 10px;
        }
        li {
            list-style: none;
            display: inline-block;
            padding: 2px 4px;
            background: #b6c2d2;
            color: #fff;
        }
    </style>
    <script src="../../libs/jquery-2.1.1.js"></script>
    <script src="../../libs/bbdchart.min.js"></script>
</head>
<body>
<div>
    <em>节点过滤</em>
    <ul id="filterUl">
        <li data-type="company">公司</li>
        <li data-type="person">人员</li>
        <li data-type="address">地址</li>
        <li data-type="orgcode">信用代码</li>
        <li data-type="email">邮箱</li>
        <li data-type="phonenumber">电话</li>
    </ul>
    <em>边过滤</em>
    <ul id="edgeFilterUl">
        <li data-type="invest">投资</li>
        <li data-type="chairmanof">董事</li>
        <li data-type="excutiveof">监事</li>
        <li data-type="managerof">高管</li>
        <li data-type="regaddress">注册地址</li>
        <li data-type="code">信用代码</li>
        <li data-type="contactway">联系方式</li>
        <li data-type="actualcontrol">实际控制人</li>
    </ul>
</div>
<div id="map"></div>
</body>
<script>
    var bbdChart = new BBDChart();
    bbdChart.init({
        container: 'map',
        type: 'rect',
        config: {
            nodeSize: 12,
            nodesInterval: 60
        }
    });
    bbdChart.drag();
    $.get('./data3.json', function (res) {
        var nl = [];
        res.nodes.map(function (d) {
            nl.push(d.properties.label);
            d.icon = '&#xe619;';
            d.size = 10 ;
            return d;
        });

        res.links.map(function (d, index) {
            d.arrow = {
                size: 'small',
                color: '#000'
            };
            d.text = {
                name: '',
                // name: d.source + '_' + d.target,
                style: {
                    textFill: '#666',
                    fontSize: 10
                }
            }
            d.style = {
                lineWidth: 0.5, // 线条粗细
                stroke: '#666'
            }
            return d;
        });
        bbdChart.graph.add({nodes: res.nodes, edges: res.links});

    });

    var filterArr = ["company", "person", "address", "orgcode", "email", "phonenumber"];
    document.querySelector('#filterUl').addEventListener('click', function (e) {

        if(!filterArr.includes(e.target.dataset.type)) {
            filterArr.push(e.target.dataset.type);
        }else {
            filterArr = filterArr.filter(function (v) {
                return v != e.target.dataset.type
            });
        }
        bbdChart.graph.filter.updateByNodeFilter('all', [function (v) {
            return filterArr.includes(v.properties.label);
        }]);

    });
    var filterEdgeArr = ["invest", "chairmanof", "excutiveof", "managerof", "regaddress", "code", "contactway", "actualcontrol"];
    document.querySelector('#edgeFilterUl').addEventListener('click', function (e) {
        if(!filterEdgeArr.includes(e.target.dataset.type)) {
            filterEdgeArr.push(e.target.dataset.type);
        }else {
            filterEdgeArr = filterEdgeArr.filter(function (v) {
                return v != e.target.dataset.type
            });
        }

        bbdChart.graph.filter.updateByEdgeFilter('all', [function (v) {
            return filterEdgeArr.includes(v.properties.label);
        }])
    });
</script>
</html>